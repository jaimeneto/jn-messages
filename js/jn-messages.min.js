/*!
 * JnMessages v1.0.0 (https://github.com/jaimeneto/jn-messages)
 * Copyright 2019 Jaime Neto <jaimeneto.com>
 * Licensed under MIT (https://github.com/jaimeneto/jn-messages/blob/master/LICENSE)
 */
class JnMessageBox{constructor(e){this._setOptions(e)}_setOptions(e){"string"==typeof e&&(e={wrapper:e}),"closable"in e&&this.setClosable(e.closable),"counter"in e&&this.setCounter(e.counter),"type"in e&&this.setType(e.type),"timeout"in e&&this.setTimeout(e.timeout),"max"in e&&this.setMax(e.max),"wrapper"in e&&this._setWrapper(e.wrapper)}_setWrapper(e){"string"==typeof e&&(this.wrapper=document.querySelector(e));const t=window.getComputedStyle(this.wrapper).display;this.display=t||"block",this.wrapper.classList.add("messages"),this.wrapper.classList.remove("floating"),this.wrapper.classList.remove("corner"),this.type&&this.wrapper.classList.add(this.type),this.wrapper.style.display="none",this.wrapper.style.opacity=0}_createFadingOut(){new MutationObserver(function(e){e.forEach(function(e){0===e.target.querySelectorAll(".message").length&&(e.target.style.opacity=0,setTimeout(()=>e.target.style.display="none",500))})}).observe(this.wrapper,{childList:!0})}_hideToMax(){const e=this.wrapper.querySelectorAll(".message");this.max&&e.length>=this.max&&e.forEach((t,s)=>s<=e.length-this.max&&t.classList.add("hidden"))}_handleCounter(e,t){if(void 0===this.counter)return!0;const s=this.wrapper.querySelectorAll(".message");var i=!0;return s.length>0&&s.forEach(function(s){if(s.classList.contains(t)&&s.querySelector(".text").innerHTML===e){var a=s.querySelector(".counter");null===a&&((a=document.createElement("div")).classList.add("counter"),a.innerText="1",s.append(a)),a.innerText=parseInt(a.innerText)+1,i=!1}}),i}show(e,t="alert"){const s=new JnMessage({text:e,type:t,closable:this.closable,timeout:this.timeout});this._handleCounter(e,t)&&(this._createFadingOut(),this._hideToMax(),s.appendTo(this.wrapper),this.wrapper.style.display=this.display,this.wrapper.style.opacity=1)}setType(e){this.type="","floating"!==e&&"corner"!==e||(this.type=e)}alert(e){this.show(e,"alert")}success(e){this.show(e,"success")}error(e){this.show(e,"error")}info(e){this.show(e,"info")}setClosable(e){this.closable=e}setCounter(e){this.counter=e}setTimeout(e){this.timeout=e}setMax(e){this.max=e}hideAll(){this.wrapper.querySelectorAll(".message").forEach(e=>e.classList.add("hidden"))}}class JnMessage{constructor(e){this._setOptions(e)}_setOptions(e){"string"==typeof e&&(e={text:e}),"text"in e&&this.setText(e.text),"closable"in e&&this.setClosable(e.closable),"timeout"in e&&this.setTimeout(e.timeout),"type"in e||(e.type="alert"),this.setType(e.type),"wrapper"in e&&this.appendTo(e.wrapper)}_render(){return this.element=document.createElement("div"),this.element.classList.add("message"),this.element.classList.add(this.type),this.closable&&this.element.classList.add("closable"),this._createText(),this.hide(),this._createFading(),this._createCloseButton(),this._fadeIn(),this.element}_createFading(){this.element.addEventListener("transitionend",e=>{this.isHidden()&&"opacity"===e.propertyName&&e.target.remove()})}_createText(){const e=document.createElement("div");e.insertAdjacentHTML("beforeend",this.text),e.classList.add("text"),this.element.prepend(e)}_createCloseButton(){if(this.closable){const e=document.createElement("a");e.href="#",e.insertAdjacentHTML("beforeend","Ã—"),e.classList.add("close-btn"),e.addEventListener("click",e=>{e.preventDefault,this.hide()}),this.element.prepend(e)}}_initTimeout(){if(this.timeout){const e=document.createElement("div");e.classList.add("timebar"),e.style.width=0,e.style.transition=`width ${this.timeout/1e3}s linear`,this.element.append(e),setTimeout(()=>e.style.width="100%",10),setTimeout(()=>this.hide(),this.timeout)}}_fadeIn(){setTimeout(()=>{this.element.classList.remove("hidden"),this._initTimeout()},100)}appendTo(e){"string"==typeof e&&(e=document.querySelector(e)),e.append(this._render())}isHidden(){return this.element.classList.contains("hidden")}hide(){this.element.classList.add("hidden")}setText(e){this.text=e}setType(e){this.type=e}setClosable(e){this.closable=e}setTimeout(e){this.timeout=1e3*e}getText(e){return this.text}getType(e){return this.type}}class JnFixedMessages extends JnMessageBox{constructor(e){super(e),JnFixedMessages.fixedMessages={},"fixedMessages"in e&&(JnFixedMessages.fixedMessages=e.fixedMessages)}static set fixedMessages(e){this._fixedMessages=e}static get fixedMessages(){return this._fixedMessages}static exists(e){return void 0!==JnFixedMessages.fixedMessages[e]}static getFixedMessage(e){return JnFixedMessages.exists(e)?JnFixedMessages.fixedMessages[e]:"Invalid message code: "+e}custom(e,t="alert"){super.show(e,t)}show(e,t){JnFixedMessages.exists(e)||(t="debug"),super.show(JnFixedMessages.getFixedMessage(e),t)}}